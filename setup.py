#!/bin/bash

# =============================================================================
# 얼굴 3D 스캐너 - 설치 및 실행 스크립트
# =============================================================================
# 
# 이 스크립트는 필요한 라이브러리를 설치하고 프로그램을 실행합니다.
# 맥북에서 터미널을 열고 이 파일이 있는 폴더에서 실행하세요.
#
# 사용법:
#   chmod +x setup_and_run.sh   (처음 한 번만)
#   ./setup_and_run.sh
#
# =============================================================================

echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║            🎭 얼굴 3D 스캐너 설치 및 실행                     ║"
echo "╚═══════════════════════════════════════════════════════════════╝"
echo ""

# 색상 정의 (터미널에서 예쁘게 보이게)
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# -----------------------------------------------------------------------------
# 1단계: Python 확인
# -----------------------------------------------------------------------------
echo -e "${BLUE}[1/4]${NC} Python 설치 확인 중..."

if command -v python3 &> /dev/null; then
    PYTHON_VERSION=$(python3 --version)
    echo -e "${GREEN}✅ $PYTHON_VERSION 발견${NC}"
else
    echo -e "${RED}❌ Python3가 설치되어 있지 않습니다.${NC}"
    echo "   다음 방법 중 하나로 설치해주세요:"
    echo "   1. App Store에서 Xcode 설치"
    echo "   2. https://www.python.org/downloads/ 에서 다운로드"
    exit 1
fi

echo ""

# -----------------------------------------------------------------------------
# 2단계: pip 업그레이드
# -----------------------------------------------------------------------------
echo -e "${BLUE}[2/4]${NC} pip 업그레이드 중..."
python3 -m pip install --upgrade pip --quiet
echo -e "${GREEN}✅ pip 업그레이드 완료${NC}"
echo ""

# -----------------------------------------------------------------------------
# 3단계: 필요한 라이브러리 설치
# -----------------------------------------------------------------------------
echo -e "${BLUE}[3/4]${NC} 필요한 라이브러리 설치 중..."
echo "   (시간이 좀 걸릴 수 있어요, 기다려주세요...)"
echo ""

# 설치할 패키지 목록
packages=("opencv-python" "numpy" "open3d" "trimesh")

for package in "${packages[@]}"; do
    echo -n "   📦 $package 설치 중... "
    if pip3 install "$package" --quiet 2>/dev/null; then
        echo -e "${GREEN}완료${NC}"
    else
        echo -e "${YELLOW}이미 설치됨 또는 스킵${NC}"
    fi
done

echo ""
echo -e "${GREEN}✅ 모든 라이브러리 설치 완료!${NC}"
echo ""

# -----------------------------------------------------------------------------
# 4단계: 프로그램 실행
# -----------------------------------------------------------------------------
echo -e "${BLUE}[4/4]${NC} 프로그램을 실행합니다..."
echo ""
echo "═══════════════════════════════════════════════════════════════"
echo ""

# 프로그램 실행
python3 main.py

# 종료 메시지
echo ""
echo "═══════════════════════════════════════════════════════════════"
echo -e "${GREEN}프로그램이 종료되었습니다.${NC}"
echo ""
echo "📁 생성된 파일들은 현재 폴더의 captured_faces_* 폴더에 있습니다."
echo ""